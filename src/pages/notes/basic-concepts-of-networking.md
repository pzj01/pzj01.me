---
title: 计算机网络基本概念
description: 计算机网络基本概念
date: 2024-11-25T15:56:00
duration: 30min
tags: [Network]
---

[[TOC]]

# 计算机网络的定义

计算机网络是指通过一定的通信设备和协议，将多个计算机和其他设备互联起来，以实现**资源共享和信息传递**的系统。

简而言之，计算机网络是用于传输数据和共享资源的连接系统。

# 计算机网络的组成

一个完整的计算机网络通常包括以下几个部分：
- 硬件：计算机、服务器、路由器、交换机、网卡、光纤、电缆等物理设备。
- 软件：用于网络通信的操作系统、协议栈（如 TCP/IP）、应用程序（如浏览器、FTP 客户端等）。
- 协议：网络中的规则和标准，用于确保设备之间能够正确通信，对数据进行封装和解封装，例如 HTTP、TCP/IP等。

# 计算机网络的分类

> 互联网是全球范围内最大的广域网。

根据**覆盖范围和规模**，计算机网络可以分为以下几类：
- 广域网（WAN，Wide Area Network）：通常跨越多个地区或国家，覆盖范围广，例如：互联网。
- 城域网（MAN，Metropolitan Area Network）：通常覆盖一个城市范围，例子：城市中的宽带网络。
- 局域网（LAN，Local Area Network）：为家庭和办公室等覆盖小范围提供网络支持，例如：学校或家庭内的宽带网络。
- 个域网（PAN，Personal Area Network）：主要为个人设备之间提供短距离通信支持，例如：通过蓝牙连接耳机、通过红外发送文件等。

根据**连接方式**，计算机网络可以分为以下几类：
- 存储区域网（SAN，Storage Area Network）：主要用于将存储设备（如磁盘阵列、磁带库）通过高速专用网络连接到服务器或主机，以实现集中化的存储管理，例如：企业内部的数据中心。
- 无线局域网（WLAN，Wireless Local Area Network）：通过无线信号（如 Wi-Fi）实现设备互联的局域网。
- 虚拟专用网（VPN，Virtual Private Network）：通过公共网络（如互联网）建立的加密通道，用于安全地传输数据，例如：梯子。
- 对等网络（P2P，Peer-to-Peer Network）：没有固定的服务器和客户端，所有节点都是平等的，既可以作为客户端，也可以作为服务器，例如：去中心化的区块链。
- 内容分发网络（CDN，Content Delivery Network）：通过在不同地理位置的服务器上存储内容，将内容快速分发到不同地理位置的用户，以提供更快的访问速度，例如：大型网站的全球加速服务。
- 蜂窝网络（Cellular Network）：基于蜂窝基站的无线通信网络，用于移动设备之间的通信，例如：移动网络。

# 网络拓扑

网络拓扑（Network Topology）是指网络中设备之间的连接方式，通常包括以下几种模式：
  - 星型（Star）：所有节点通过独立的通信链路连接到一个中央设备（如交换机或集线器）。
  - 总线（Bus）：所有节点通过一条共享的通信介质（通常是主干电缆）连接。
  - 环型（Ring）：节点通过通信链路依次连接，形成一个封闭的环。
  - 树型（Tree）：每个节点通过专用链路直接连接到一个或多个其他节点。
  - 网状（Mesh）：基于层次结构，每个节点通过树形分支连接到其他节点。

# OSI 模型

**OSI 模型**（Open Systems Interconnection Model）由国际标准化组织（ISO）在 1984 年提出，是一个理论上的参考模型，描述了网络通信的分层架构。
在之后的模型都是从这个模型中演化而来的。

## OSI 的七层结构

| 顺序 | 名称 | 描述 | 单位/标准 |
| --- | --- | --- | --- |
| 7 | 应用层 | 网络协议接口，负责为用户和应用程序提供网络服务，如文件传输、电子邮件等。 | 网络协议，如 HTTP、FTP 等 |
| 6 | 表示层 | 负责数据格式转换和加密解密，确保不同系统能正确理解数据（如文字编码、压缩）。 | 网络协议，如 HTTP、FTP 等 |
| 5 | 会话层 | 负责会话管理和用户认证，确保数据传输的可靠性和安全性。 | 网络协议，如 HTTP、FTP 等 |
| 4 | 传输层 | 提供端到端的通信，负责分段和重组，确保可靠传输（如 TCP、UDP）。 | 数据段 |
| 3 | 网络层 | 负责**路由**选择和寻址，将数据从一个节点传送到另一个节点（如 IP 协议）。 | 数据包 |
| 2 | 数据链路层 | 负责**物理**地址寻址、错误检测和帧的传输（如以太网、MAC）。 | 数据帧 |
| 1 | 物理层 | 定义物理媒介的标准，如电压、线缆、接口和信号传输方式。 | 比特（bit） |

# TCP/IP 模型

**TCP/IP 模型**（Transmission Control Protocol/Internet Protocol Model）是一个实用的**通信协议模型**，是当前互联网的基础。
它基于 OSI 模型，但简化了分层结构，侧重实际应用。

## TCP/IP 的四层结构

| 顺序 | 名称 | 描述 | 示例协议 |
| --- | --- | --- | --- |
| 4 | 应用层 | 提供网络服务的接口（包括 OSI 的应用层、表示层、会话层的功能）。| HTTP、FTP、SMTP、DNS |
| 3 | 传输层 | 传提供端到端通信服务，确保可靠性或快速传输。| TCP、UDP |
| 2 | 网络层 | 负责路由和寻址，将数据包传递到目标地址。| IP、ICMP、ARP |
| 1 | 链路层 | 包含 OSI 模型的物理层和数据链路层功能，负责物理连接和帧传输。`| 以太网、IEEE 802.3、IEEE 802.11 |

# 什么是 IP 地址？

IP 地址（Internet Protocol Address）是分配给网络中每台设备的唯一标识符，用于定位设备并进行数据传输。

IP 地址分为两部分：
  - 网络部分：标识网络范围，决定设备属于哪个子网。
  - 主机部分：标识网络中的具体设备。
对于如何表达网络部分和主机部分，由[子网掩码](#子网掩码)决定。

# IPv4 地址的基本结构

长度为 32 位的地址，使用十进制表示，通常表示为 `A.B.C.D` 的形式，每个部分为 0 到 255 的数字。

## 二进制表示

IPv4 地址由 32 位二进制数表示，分为 4 组，每组 8 位（一个字节）。
例如：`11000000 10101000 00000001 00000001`

## 点分十进制表示

为便于理解，IPv4 通常以点分十进制表示，每 8 位转换为 10 进制。
例如：`11000000 10101000 00000001 00000001` → `192.168.1.1`

# IPv6 地址的基本结构

长度为 128 位的地址，使用十六进制表示，通常表示为 `A.B.C.D.E.F.G.H` 的形式，每个部分为 0 到 65535 的数字，为了解决 IPv4 的地址不够用而发明的。

## 表示形式

IPv6 使用 128 位，分为 8 组，每组为 16 位的十六进制数，组与组之间用冒号分隔。例如：`2001:0db8:85a3:0000:0000:8a2e:0370:7334`。

对于组内的连续的零，可以使用零压缩，可以简化连续的 0。例如：
`2001:0db8:0000:0000:0000:8a2e:0370:7334` → `2001:db8::8a2e:370:7334`

# 子网掩码

子网掩码（Subnet Mask）是一个 32 位的数字，用来区分 IP 地址的“网络部分”和“主机部分”。

## 表示形式

与 IPv4 地址类似，子网掩码也用点分十进制表示（如 255.255.255.0）。
二进制形式为连续的 1 表示网络部分，连续的 0 表示主机部分。
例如：`255.255.255.0` → `11111111.11111111.11111111.00000000`

计算获取网络地址：
```go
192.168.1.10 → 11000000.10101000.00000001.00001010 (IP 地址)
& // 与运算
255.255.255.0 → 11111111.11111111.11111111.00000000 (子网掩码)
结果为：11000000.10101000.00000001.00000000 (网络地址)
```

### 前缀表示法

前缀表示法（CIDR，Classless Inter-Domain Routing）是描述 IP 地址与子网掩码的一种紧凑形式，它将子网掩码的连续 1 的数量直接标注为 IP 地址的一部分。

前缀表示法的结构：
  - 格式：IP地址/网络前缀长度
    - IP地址：设备的标识，如 `192.168.1.0`。
    - 网络前缀长度：子网掩码中连续 1 的位数。
      - `/24` → 子网掩码有 24 位 1，即 `255.255.255.0`。
      - `/16` → 子网掩码有 16 位 1，即 `255.255.0.0`。

## 特殊地址

- `127.0.0.1`：表示本地主机，这个地址是用于测试本地网络接口，向这个地址发送的数据最终会返回给计算机，也称为本地回环地址。
- 网络地址：用于标识整个子网，便于路由器和交换机管理网络范围，它是子网中主机部分全为 0 的 IP 地址，网络地址本身不能分配给具体的主机，例如：`192.168.1.0`。
- 广播地址：用于一次性向子网中的所有设备发送数据包，它是子网中主机部分全为 1 的 IP 地址，广播地址本身不能分配给具体的主机，例如：`192.168.1.255`。

## 计算子网数量和主机数量

<p>
  子网数量的计算公式：
  <math xmlns="http://www.w3.org/1998/Math/MathML">
    <mrow>
      <mi>子网数量</mi>
      <mo>=</mo>
      <msup>
        <mn>2</mn>
        <mi>n</mi>
      </msup>
    </mrow>
  </math>
</p>

- n 是从主机部分借用的位数（变为子网位）。

例如：`192.168.1.0/24`的子网数量为 1，这是一个完整的子网，并没有经过划分。

<p>
  主机数量的计算公式：
  <math xmlns="http://www.w3.org/1998/Math/MathML">
    <mrow>
      <mi>主机数量</mi>
      <mo>=</mo>
      <msup>
        <mn>2</mn>
        <mi>m</mi>
      </msup>
      <mo>-</mo>
      <mn>2</mn>
    </mrow>
  </math>
</p>

- m 是主机部分的位数。
- 减 2 是因为每个子网的网络地址和广播地址不能分配给主机。

例如：`192.168.1.0/24`的主机数量为 254（1~254），因为每个子网的网络地址和广播地址不能分配给主机。

# 公网 IP

公网 IP（Public IP）是指在互联网上可直接访问的 IP 地址。它是全球唯一的，由 互联网数字分配机构（IANA） 分配，通常通过 ISP（互联网服务提供商） 提供。比如：家庭路由器的 WAN 口地址（由 ISP 提供）、8.8.8.8（Google 公共 DNS）、114.114.114.114（中国公共 DNS）。

# 私网 IP

私有 IP（Private IP）是保留用于本地网络（LAN）通信的地址。它不能直接与互联网通信，通常需要通过 NAT（网络地址转换） 技术映射到公网 IP。比如：家庭路由器的 LAN 口地址（自动分配）、192.168.1.10（自动分配）。

> 为什么需要私有 IP？
> - 节约 IP 地址资源： IPv4 地址空间有限（约 43 亿个），直接为每台设备分配公网 IP 会很快耗尽资源。私有 IP 允许**多个设备共享一个公网 IP**，通过 NAT 实现互联网访问。
> - 提高安全性：私有 IP 地址不会暴露在互联网上，降低了外部攻击的风险。网络管理员可以通过路由器和防火墙管理局域网设备的访问权限。
> - 灵活性：私有 IP 可在本地网络中**重复使用**，不受全球 IP 地址分配的限制。

# 应用层协议

## HTTP/HTTPS

HTTP（Hypertext Transfer Protocol）：超文本传输协议，用于在客户端（如浏览器）与服务器之间传输超文本数据（如网页）。

- 特点：无状态、明文传输，端口号通常为 80。
- 缺点：数据传输不安全，容易被窃听。

HTTPS（HTTP Secure）：HTTP + SSL/TLS，通过加密提高安全性，可以理解为 HTTP 的加密版本。
- 特点：数据加密、身份验证，端口号通常为 443。

> SSL（Secure Sockets Layer）：是一种加密协议，用于在网络中保护数据的传输安全，但是现在已经被TLS取代。

> TLS（Transport Layer Security）：是一种加密协议，用于在网络中保护数据的传输安全，是 SSL 的一个升级版本，使用更安全的加密算法以及安全证书。

## DNS

DNS（Domain Name System）是互联网的核心服务之一，它的主要功能是**将域名（如 www.google.com）解析为IP 地址**，也可以反向解析，从而帮助用户以更友好的方式访问网络资源。

### 域名结构

域名由多个结构组成，依次从右到左解析。
- 顶级域名（TLD，Top-Level Domain）：顶级域名是最高级别的域名，通常是国家顶级域名（如 .com、.net、.org 等）。
- 二级域名（SLD，Second-Level Domain）：子域名是顶级域名的下一级，如 `example.com` 中的 `example`。
- 子域名（subdomain）：子域名是二级域名的下一级，如 `www.example.com` 中的 `www`。

对于任何由你控制的域名（例如 mozilla.org），你可以创建包含不同内容的“子域名”（例如 developer.mozilla.org、iot.mozilla.org 或 bugzilla.mozilla.org）。

### DNS 服务器

- 根 DNS 服务器：
  - 位于域名系统的最顶层，掌管顶级域名（TLD）信息。
  - 全球有 13 个逻辑根服务器（编号为 A 到 M），实际有数百个副本。
- 顶级域名服务器：
  - 管理特定顶级域名（如 .com 或 .org）下的域名信息。
- 权威 DNS 服务器：
  - 管理具体域名的信息，例如 example.com 的权威 DNS 服务器。
- 递归解析服务器（本地 DNS 服务器）：
  - 接收客户端的查询请求并递归查找结果，通常由 ISP 或企业提供。

### 域名解析过程

当用户在浏览器中输入 `www.example.com` 时，DNS 的工作流程如下：
  1. 检查本地缓存，浏览器或操作系统会先检查本地是否已缓存 www.example.com 的 IP 地址，如果有就直接返回。
  2. 向本地 DNS 服务器查询：如果缓存中没有，客户端会向本地 DNS 服务器（通常由 ISP 提供）发送查询请求。
  3. 递归查询或迭代查询：
      - 如果本地 DNS 服务器没有结果：
        - 本地 DNS 服务器可能会递归查询其他 DNS 服务器。
        - 或者，它会返回下一级权威 DNS 服务器地址给客户端，由客户端进行迭代查询。
  4. 返回结果：找到对应的 IP 地址后，将结果返回给客户端。
  5. 连接目标服务器：客户端使用获取的 IP 地址与目标服务器建立连接。

### 查询类型

- 递归查询
  - 客户端向本地 DNS 服务器发送请求，本地 DNS 服务器全程负责查询，直到返回最终结果。
  - 客户端无需进一步操作。
- 迭代查询
  - 本地 DNS 服务器逐级向根 DNS、TLD DNS 和权威 DNS 服务器发送请求。
  - 每一级服务器只提供下一步查询的地址，查询由本地 DNS 服务器完成。

### 记录类型

| 类型 | 说明 |
| --- | --- |
| A 记录 | 将域名映射到 IPv4 地址 |
| AAAA 记录 | 将域名映射到 IPv6 地址 |
| CNAME 记录 | 将域名作为别名映射到另一个域名 |
| MX 记录 | 定义邮件服务器地址，用于电子邮件的收发。|
| NS 记录 | 定义域名由哪个 DNS 服务器解析。 |
| SOA 记录 | 定义最佳的 DNS 服务器 |
| PTR 记录 | 将域名映射到 IP 地址 |
| TXT 记录 | 存储文本信息，常用于验证域名所有权或配置邮件（如 SPF）。|

### 常用端口

| 协议 | 端口 | 说明 |
| --- | --- | --- |
| UDP | 53 | 用于 DNS 查询和解析，是大多数 DNS 查询的默认协议。 |
| TCP | 53 | 用于 DNS 区域传输或较大的 DNS 查询响应（如超过 512 字节时）。|

## SSH

SSH（Secure Shell）是一种网络通信协议，专为在不安全的网络中提供安全的远程登录和其他安全网络服务而设计。它通过加密技术保护传输的数据，防止窃听和中间人攻击。

### 主要应用

1. 远程登录
    - 允许用户通过命令行或图形界面访问远程服务器。
    - 提供安全的登录环境，替代不安全的 Telnet 或 RSH 协议。
2. 文件传输
    - 支持通过加密的方式上传和下载文件。
      - SCP（Secure Copy Protocol）：基于 SSH 的文件复制协议。
      - SFTP（Secure File Transfer Protocol）：SSH 的文件传输协议，比传统 FTP 更安全。
3. 端口转发
    - 提供隧道技术，将不安全的网络协议封装在 SSH 中传输。
    - 本地端口转发：将本地请求转发到远程服务器。
    - 远程端口转发：将远程请求转发到本地。
    - 动态端口转发：类似 SOCKS 代理，允许灵活的请求转发。
4. 网络管理
    - 通过 SSH 访问网络设备（如路由器、交换机）以进行配置和维护。

### 基本使用

登录 SSH：

```bash
ssh username@hostname
```

第一次登录，会提示：

```bash
ssh username@hostname

output: The authenticity of host 'host (12.18.429.21)' can't be established.
RSA key fingerprint is 98:2e:d7:e0:de:9f:ac:67:28:c2:42:2d:37:16:58:4d.
Are you sure you want to continue connecting (yes/no)? yes
Password: (enter password):
```

以上这句话的意思是：无法确定主机 `host（12.18.429.21）` 的真实性。RSA 密钥指纹为`98:2e:d7:e0:de:9f:ac:67:28:c2:42:2d:37:16:58:4d`。是否确实要继续连接（是/否）？回答 yes 后，就会继续进行连接了，然后输入密码。

这种每次输入密码的方式非常麻烦，因此 SSH 提供了一种更安全的方式：SSH 公钥认证。

### SSH 公钥认证

1. 生成密钥对（公钥/私钥），使用 `ssh-keygen` 命令生成，`-t` 参数指定密钥类型，`-b` 参数指定密钥长度。

> [!NOTE]
> 使用以下命令之后，会在`$HOME/.ssh`下生成 `id_rsa` 和 `id_rsa.pub` 文件，前者是私钥，后者是公钥。

```bash
ssh-keygen -t rsa -b 4096
```

2. 将公钥传输到远程服务器上：

```bash
ssh-copy-id username@hostname
```

从现在开始就可以不用密码登录了。如果还是不行，就打开远程主机的 `/etc/ssh/sshd_config` 这个文件，检查下面几行前面 "#" 注释是否取消掉。

```bash
RSAAuthentication yes # 表示允许使用 RSA 公钥认证，SSH-1.0 配置
PubkeyAuthentication yes # 表示允许使用公钥认证，SSH-2.0 配置
AuthorizedKeysFile .ssh/authorized_keys # 表示存储公钥的文件路径
```

然后，重启远程主机的ssh服务。

### 工作原理

SSH 使用 公钥加密 和 对称加密 的组合：
  - 建立加密会话：客户端和服务器协商加密算法并交换密钥。
  - 身份验证：支持密码认证和公钥认证。
  - 加密数据传输：会话数据被加密后传输。

## FTP/SFTP/FTPS

FTP（File Transfer Protocol）是一个用于在计算机网络中传输文件的标准协议，它工作在 应用层，提供简单易用的文件上传和下载功能。尽管因安全性问题在现代网络中逐渐被更安全的替代协议（如 SFTP、FTPS）取代，FTP 仍然广泛用于某些场景。

### 主要功能

- 文件上传：将本地文件发送到远程服务器。
- 文件下载：从远程服务器获取文件。
- 目录管理：支持创建、删除、修改和查看目录内容。
- 文件管理：支持重命名、删除、移动文件。

### 工作原理

FTP 使用 Client-Server 模型，通过两个独立的通道进行通信：
  - 控制通道：
    - 用于发送命令和响应，保持客户端和服务器之间的连接。
    - 监听在 TCP 21 端口。
  - 数据通道：
    - 用于传输文件数据。
    - 动态分配端口（在主动模式和被动模式下的处理方式不同）。

#### 工作模式

- 主动模式（Active Mode）：
  - 客户端打开一个端口，告诉服务器用于数据传输。
  - 服务器主动连接到客户端的该端口。

> 问题：需要客户端允许来自服务器的主动连接，在 NAT 和防火墙下可能有兼容性问题。

- 被动模式（Passive Mode）：
  - 服务器打开一个端口，并告诉客户端。
  - 客户端主动连接到服务器的该端口进行数据传输。

> 优点：更适合现代网络环境，因为不需要客户端暴露端口。

### 安全扩展协议

为了克服 FTP 的安全缺陷，产生了一些改进协议：
- SFTP
  - 基于 SSH 的文件传输协议。
  - 数据和控制信息均加密。
  - 使用单个端口（通常是 TCP 22），比 FTP 更安全。
- FTPS
  - 基于 SSL/TLS 的安全 FTP。
  - 加密数据传输，防止窃听。
  - 保持与传统 FTP 类似的操作方式。

## SMTP/SMTPS

SMTP（Simple Mail Transfer Protocol，简单邮件传输协议）是 应用层协议，专门用于在计算机网络中传输电子邮件。它是邮件系统中最核心的协议之一，用于邮件的发送、转发和接收。

### 主要功能

- 发送邮件：用户通过邮件客户端（如 Outlook、Thunderbird）将邮件发送到邮件服务器，服务器使用 SMTP 将邮件传输到目标服务器。
- 转发邮件：如果邮件的目标服务器不在当前域内，SMTP 会将邮件转发给其他中继服务器。
- 接收邮件：SMTP 协议在发送邮件时，也可用作接收邮件（由服务器之间传递）。

### 工作原理

SMTP 使用 客户端-服务器模型，基于 TCP 传输层，默认使用端口 25 进行通信（现代网络中常使用端口 587 或 465 支持加密）。

SMTP 的通信过程可以分为三个阶段：
  1. 建立连接：客户端连接到邮件服务器，通常通过 TCP 端口 25 或 587。
  2. 发送邮件数据：通过一系列命令传输邮件头和内容。
  3. 关闭连接：客户端发送 QUIT 命令，关闭与服务器的连接。

### 常用端口

- 端口 25：
  - 最早的默认端口，常用于服务器间的邮件传输。
  - 许多 ISP 限制其外部访问，以防止垃圾邮件。
- 端口 587：用于邮件客户端与服务器的安全邮件传输，推荐使用。
- 端口 465：用于加密的 SMTP（SMTPS），通过 SSL/TLS 加密数据。

### 状态码

SMTP 通信过程中，服务器会返回状态码以表示操作结果，常见的状态码有：

| 状态码 | 描述 |
| --- | --- |
| 220 | 服务就绪，可以开始传输数据。 |
| 250 | 请求的命令成功完成。 |
| 354	| 开始发送邮件数据。 |
| 421	| 服务不可用，关闭传输通道。 |
| 450	| 请求的邮箱不可用（例如邮箱被锁定）。 |
| 451	| 请求操作中止，服务器遇到错误 。|
| 550	| 收件人地址不存在。 |
| 554	| 传输失败或邮件被服务器拒绝（如被识别为垃圾邮件）。 |

## POP3/IMAP

POP3（Post Office Protocol version 3）和 IMAP（Internet Message Access Protocol）是两种用于从邮件服务器检索电子邮件的协议，属于应用层协议。它们被广泛应用于电子邮件客户端与服务器之间的通信。

### 什么是 POP3 ？

POP3 是一种简单的协议，用于将邮件从邮件服务器下载到客户端设备。POP3 设计简单，适用于本地化存储和离线访问。

特点：
  - 单一存储：邮件通常会被下载到客户端设备后从服务器上删除。
  - 离线访问：邮件下载到本地后，无需网络即可查看。
  - 有限的服务器同步：由于邮件被删除，客户端与服务器之间的同步能力有限。

### 工作原理

POP3 的通信过程可以分为四个阶段：
1. 连接服务器：客户端通过用户凭据连接邮件服务器。
2. 下载邮件：所有新邮件被下载到本地设备。
3. 删除邮件（可选）：默认会从服务器上删除已下载的邮件。
4. 断开连接：完成后断开与服务器的连接。

### 常用端口

- 端口 110：用于 POP3，推荐使用。
- 端口 995：加密端口（使用 SSL/TLS）。

### 什么是 IMAP ？

IMAP 是一种更先进的协议，用于从服务器读取邮件。IMAP 允许邮件在服务器端存储，并支持多设备同步。

### 特点

- 服务器存储：邮件保存在服务器上，客户端仅获取副本。
- 多设备同步：适合在多个设备（手机、电脑、平板等）上访问同一邮箱。
- 服务器管理：可以在服务器端管理邮件（如创建文件夹、标记状态）。

### 工作原理

IMAP 的通信过程可以分为四个阶段：
1. 连接服务器：客户端通过用户凭据连接服务器。
2. 同步邮件：客户端获取邮件头和基本信息（而不是下载整个邮件）。
3. 按需获取内容：点击查看邮件时，再从服务器获取具体内容。
4. 实时同步：对邮件的操作（如标记已读、删除）会同步到服务器。

### 常用端口

- 端口 143：默认端口（未加密）。
- 端口 993：加密端口（使用 SSL/TLS）。

### POP3 和 IMAP 的区别

| 特点 | POP3 | IMAP |
| --- | --- | --- |
| 存储位置 | 邮件下载到本地，通常从服务器删除 | 邮件保存在服务器 |
| 同步能力 | 不支持多设备同步 | 支持多设备同步 |
| 访问模式 | 离线访问 | 在线访问 |
| 文件夹管理 | 不支持文件夹管理 | 支持在服务器上创建和管理文件夹 |
| 适用场景 | 需要离线访问，邮件存储在本地 | 多设备访问，需要保持实时同步 |
| 带宽消耗 | 下载所有邮件，占用带宽 | 仅下载需要的邮件头，占用较少带宽 |

# 传输层协议

## TCP

TCP 是一种**面向连接的传输层协议**，为应用层提供**可靠的数据传输服务**。它是**因特网协议栈（TCP/IP 协议族）** 的核心协议之一，广泛应用于需要数据完整性和顺序性保障的场景，如网页浏览（HTTP/HTTPS）、电子邮件（SMTP/IMAP）等

### 特点

- 面向连接
  - 在通信前，必须通过**三次握手**建立连接。
  - 在数据传输完成后，通过**四次挥手**释放连接。
- 可靠传输
  - 数据分段：将数据分成适合传输的小段。
  - 序列号：每个数据段都有序列号，保证数据按顺序组装。
  - 确认机制：接收方通过 ACK（Acknowledgment）确认接收到的数据。
  - 重传机制：若超时未收到确认，自动重发丢失的数据。
- 流量控制
  - 使用滑动窗口机制，调节发送方的速度，防止接收方因负载过高而丢包。
- 拥塞控制
  - 根据网络状况动态调整发送速度，避免因网络过载而导致通信质量下降。

> [!NOTE]
> 全双工表示：可以同时在两端传输，比如：电话。<br>
> 半双工表示：同一时间只能有一个端口传输，比如：对讲机，只能有一个人说话，另一个人只能听。

- 全双工通信
  - 数据可以同时在两端传输，发送方和接收方均可独立发送和接收数据。

### 报文格式

TCP 数据报文由**头部**和**数据部分**组成。TCP 头部长度通常为 20 字节（不含可选字段），主要包含以下字段：

| 字段 | 长度（位/bits） | 说明 |
| --- | --- | --- |
| 源端口（Source Port）| 16 | 表示发送端的端口号，用于标识发送方的应用程序。 |
| 目的端口（Destination Port） | 16 | 表示接收端的端口号，用于标识接收方的应用程序。 |
| 序列号（Sequence Number）| 32 | 表示本报文段数据的序号，确保数据按序组装。 |
| 确认号（Acknowledgment Number）| 32 | 确认接收到的数据序号，表示接收方期望的下一个序号。 |
| 数据偏移（Data Offset）| 4 | 指示 TCP 头部的长度（以 4 字节为单位），用于定位数据部分的起始位置。 |
| 保留字段（Reserved）| 6 | 保留未用，置 0。 |
| 标志位（Flags）| 6 | 用于控制连接状态的标志位，包括 SYN、ACK、FIN 等。 |
| 窗口大小（Window Size）| 16 | 表示接收方当前的缓冲区大小，用于流量控制。 |
| 校验和（Checksum）| 16 | 计算 TCP 头部的校验和，用于检测数据的完整性。 |
| 紧急指针（Urgent Pointer）| 16 | 表示紧急数据的位置，用于处理拥塞情况。 |
| 可选字段（Options）| 可变长度 | 可选字段，用于扩展 TCP 头部，包括 TCP 拥塞控制、流量控制等。 |

```ts
// TCP.ts，模拟 TCP 头部

enum TCPFlags {
  SYN, // 同步请求建立连接，用于 三次握手的第一步。
  ACK, // 确认已接收到的数据，用于响应对方的报文。
  FIN, // 结束请求断开连接，用于 四次挥手的第一步。
  RST, // 重置连接，用于异常终止连接或拒绝连接请求。
  PSH, // 立即推送数据到接收方应用层，而不必等待缓冲区填满。
  URG, // 紧急数据，需要接收方优先处理（紧急数据结束位置由紧急指针 Urgent Pointer 标识）。
  ECE, // 拥塞控制，用于控制数据传输速度和流量。
  CWR, // 拥塞窗口缩小，用于避免拥塞时的数据丢失。
  NS, // 不分流，用于避免拥塞时的数据丢失。
}

interface TCPHeader {
  sourcePort: number
  destinationPort: number
  sequenceNumber: number
  acknowledgementNumber: number
  dataOffset: number
  reserved: number
  flags: number
  windowSize: number
  checksum: number
  urgentPointer: number
  options?: number[]
}

const tcpHeader: TCPHeader = {
  sourcePort: 433,
  destinationPort: 80,
  sequenceNumber: 0, // 指示本报文段数据的序号，确保数据按序组装。
  acknowledgementNumber: 0, // 确认接收到的数据序号，表示接收方期望的下一个序号。
  dataOffset: 5, // 指示 TCP 头部的长度（以 4 字节为单位），用于定位数据部分的起始位置。
  reserved: 0, // 保留未用，置 0。
  flags: TCPFlags.SYN, // 用于控制连接状态的标志位，包括 SYN、ACK、FIN 等。
  windowSize: 0, // 表示接收方当前的缓冲区大小，用于流量控制。
  checksum: 0, // 计算 TCP 头部的校验和，用于检测数据的完整性。
  urgentPointer: 0, // 表示紧急数据的位置，用于处理拥塞情况。
  options: [], // 可选字段，用于扩展 TCP 头部，包括 TCP 拥塞控制、流量控制等。
}
```

### 工作流程

三次握手确保了连接双方都能互相确认彼此的存在并准备好通信，而四次挥手用于保证双方都能完全关闭连接。

三次握手（建立连接）：
  1. 第一次握手：
      - 客户端发送一个 SYN（同步序号）报文，表示希望建立连接。
      - SYN 报文包含客户端的初始序列号。
  2. 第二次握手：
      - 服务端接收 SYN 后，发送一个带有 SYN 和 ACK 的报文，表示接受请求并同步序号。
      - ACK 用于确认接收到客户端的 SYN，SYN 用于向客户端同步序号。
  3. 第三次握手：
      - 客户端接收服务端的 SYN+ACK 后，发送一个 ACK 报文，确认连接建立。

```go
客户端               服务端
  SYN  ------------>
       <------------  SYN+ACK
  ACK  ------------>
```

四次挥手（释放连接）：
  1. 第一次挥手：
      - 客户端发送一个 FIN 报文，表示不再发送数据，但可以接收数据。
  2. 第二次挥手：
       - 服务端接收 FIN 后，返回一个 ACK 报文，确认关闭请求。
  3. 第三次挥手：
      - 服务端发送一个 FIN 报文，表示数据传输结束，准备关闭连接。
  4. 第四次挥手：
      - 客户端接收 FIN 后，返回 ACK 并进入 TIME_WAIT 状态，等待一段时间以确保服务端收到 ACK 后关闭连接。

```go
客户端               服务端
  FIN  ------------>
       <------------  ACK
       <------------  FIN
  ACK  ------------>
```

### 数据可靠性机制

- 序列号和确认号
  - 序列号：确保数据按序传输，避免乱序。
  - 确认号：接收方发送确认号，告知发送方已成功接收的数据。
- 超时重传
  - 发送方在指定时间内未收到 ACK，会重新发送数据。
- 滑动窗口
  - 控制发送数据的大小，防止接收方的缓冲区溢出。
- 校验和
  - 用于检测数据在传输过程中是否被篡改或损坏。

## UDP

## ICMP

## SCTP

## DCCP

## QUIC

# 网络层协议

## IP

## ARP

## ICMP
